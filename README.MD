# Neural Nonlinear Predictive Control (NPL)
*(Nieliniowe sterowanie predykcyjne obiektem typu Black-Box z uÅ¼yciem sieci neuronowych)*

![MATLAB](https://img.shields.io/badge/MATLAB-R2025b-orange)
![Toolbox](https://img.shields.io/badge/Toolbox-Deep%20Learning-blue)
![Subject](https://img.shields.io/badge/Subject-Control%20Theory-green)

## ğŸ“Œ O projekcie
Projekt dotyczy identyfikacji oraz sterowania nieliniowym obiektem dynamicznym typu **SISO Black-Box**. GÅ‚Ã³wnym celem byÅ‚a implementacja regulatora **NPL (Nonlinear Predictive Control with Linearization)**, w ktÃ³rym wytrenowana sieÄ‡ neuronowa odpowiada za predykcjÄ™ trajektorii swobodnej.

W ramach prac zrealizowano peÅ‚en proces modelowania (od generacji danych po wdroÅ¼enie w pÄ™tli sprzÄ™Å¼enia zwrotnego), porÃ³wnujÄ…c dwa podejÅ›cia do modelowania dynamiki:
1. **ELM (Extreme Learning Machine)** â€“  szybka implementacja macierzowa.
2. **Model Hybrydowy** â€“ zaawansowana architektura przy uÅ¼yciu *Deep Learning Toolbox**, wykorzystujÄ…ca nieliniowe transformacje wejÅ›Ä‡ ($\sin, \cos$).

Dodatkowo przeprowadzono analizÄ™ algorytmÃ³w uczenia dla modelu hybrydowego, wykazujÄ…c w tym przypadku przewagÄ™ optymalizatora **L-BFGS** nad algorytmem **ADAM** w kontekÅ›cie szybkoÅ›ci zbieÅ¼noÅ›ci i dokÅ‚adnoÅ›ci ostatecznej predykcji.

## âš™ï¸ Obiekt BadaÅ„
Sterowany proces ("Proces 10") jest obiektem symulowanym, ktÃ³rego model matematyczny nie jest znany projektantowi.
* **Typ:** SISO (jedno wejÅ›cie, jedno wyjÅ›cie).
* **Identyfikacja wstÄ™pna:** W celu analizy zachowania ukÅ‚adu wyznaczono charakterystykÄ™ statycznÄ… $y(u)$.
* **Dynamika:** Obiekt charakteryzuje siÄ™ opÃ³Åºnieniem oraz silnÄ… nieliniowoÅ›ciÄ….


<p align="center">
  <img src="img/cs.png" alt="Charakterystyka statyczna" width="600">
  <br>
  <em>Rys. 1: Zidentyfikowana charakterystyka statyczna obiektu.</em>
</p>

## ğŸ§  Modele Neuronowe i Identyfikacja

W projekcie zbadano wpÅ‚yw architektury sieci oraz algorytmu uczenia na jakoÅ›Ä‡ predykcji.

| Model | Architektura | Metoda uczenia | Wyniki (MSE) |
|---|---|---|---|
| **ELM** | Feedforward, warstwa ukryta $\tanh$. Losowe wagi wejÅ›ciowe. | Analityczna (Najmniejsze Kwadraty) | $10^{-6}$ (Bardzo dobry) |
| **Hybrydowy** | Custom Layer z transformacjÄ… trygonometrycznÄ… ($\sin, \cos$). | **L-BFGS** (Deep Learning Toolbox) | $10^{-4}$ (Dobry) |
| **Liniowy** | ARX. | Analityczna | Referencyjny (SÅ‚aby) |

**Kluczowe wnioski z identyfikacji:**
* Algorytm **L-BFGS** (Limited-memory BFGS) zapewniÅ‚ znacznie szybszÄ… zbieÅ¼noÅ›Ä‡ i lepszÄ… dokÅ‚adnoÅ›Ä‡ niÅ¼ standardowy algorytm **ADAM** dla badanego problemu regresji.
* Model ELM okazaÅ‚ siÄ™ najefektywniejszy obliczeniowo przy zachowaniu najwyÅ¼szej dokÅ‚adnoÅ›ci dla tego konkretnego obiektu.

## ğŸš€ Algorytm Sterowania: NPL
Zaimplementowano algorytm **NPL**, ktÃ³ry stanowi wydajnÄ… obliczeniowo alternatywÄ™ dla klasycznego NMPC. Algorytm unika kosztownej optymalizacji nieliniowej online poprzez linearyzacjÄ™ modelu neuronowego wzdÅ‚uÅ¼ trajektorii predykcji. Testy wykazaÅ‚y wysokÄ… skutecznoÅ›Ä‡ regulacji niezaleÅ¼nie od punktu pracy, z najlepszymi wynikami dla modelu ELM.

**Zasada dziaÅ‚ania:**
1. **Predykcja swobodna:** Wyznaczana na peÅ‚ny horyzont na podstawie nieliniowego modelu neuronowego (ELM lub Hybrydowego).
2. **Linearyzacja:** W kaÅ¼dym kroku sterowania wyznaczany jest lokalny model liniowy.
3. **Prawo sterowania:** Przyrosty sterowania obliczane sÄ… analitycznie, analogicznie do algorytmu DMC:

$$\Delta \mathbf{U} = (\mathbf{M}^T \mathbf{M} + \lambda \mathbf{I})^{-1} \mathbf{M}^T (\mathbf{Y}_{zad} - \mathbf{Y}^0)$$

Gdzie $\mathbf{Y}^0$ to trajektoria swobodna wyznaczona przez sieÄ‡ neuronowÄ….

## ğŸ“‚ Struktura Repozytorium

### `/src` - Kody ÅºrÃ³dÅ‚owe
* **`NPL.m`** â€“ GÅ‚Ã³wny skrypt regulatora. Realizuje pÄ™tlÄ™ sprzÄ™Å¼enia zwrotnego, predykcjÄ™ neuronowÄ… i obliczanie sterowania.
* **`hybrydowy.m`** â€“ Implementacja i trening modelu hybrydowego w Deep Learning Toolbox (L-BFGS).
* **`elm.m`** â€“ Implementacja i trening sieci ELM.
* **`gen_datasets.m`** â€“ Generowanie danych treningowych i testowych.
* **`wyznacz_char_statyczna.m`** â€“ Wyznaczanie charakterystyki statycznej obiektu.
* **`leastsquares.m`** â€“ Model ARX, metoda najmniejszych kwadratÃ³w.
* **`proces10_symulator.p`** â€“ Symulator obiektu Black-Box (plik binarny).

### `/data` - Parametry modeli
* **`elm_params.mat`** â€“ Wytrenowane parametry sieci ELM.
* **`dl_tbx_params.mat`** â€“ Wytrenowane parametry modelu hybrydowego.

### `/docs` - Dokumentacja
* **`Sprawozdanie.pdf`** â€“ PeÅ‚ne sprawozdanie techniczne z testami, analizÄ… oraz wynikami.

## ğŸ”§ Wymagania i Uruchomienie

* **MATLAB R2025b**.
* **Deep Learning Toolbox** (wymagany dla skryptu `hybrydowy.m`).

**Instrukcja:**
1. Wygeneruj dane treningowe: uruchom `gen_datasets.m`.
2. Wytrenuj modele: uruchom `elm.m` oraz `hybrydowy.m`.
3. Uruchom symulacjÄ™ sterowania:
   * OtwÃ³rz `NPL.m`.
   * Wybierz model (zmienna `model = 'elm'` lub `'hybrydowy'`).
   * Uruchom skrypt.

## ğŸ“„ Licencja
Projekt udostÄ™pniony na licencji MIT.

## ğŸ‘¨â€ğŸ’» Autor
* **Dominik Bijoch**

---
*Projekt zrealizowany w ramach przedmiotu "Sztuczna Inteligencja w Automatyce" na Politechnice Warszawskiej (Semestr 25Z).*